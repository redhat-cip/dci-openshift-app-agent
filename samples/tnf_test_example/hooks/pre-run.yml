---

# First task to do: if the variables are not correctly defined, do not continue.
- name: Declare tnf variables
  include_tasks: declare_tnf_variables.yml

# Make sure that we don't have any remaining resources before starting tests, just
# in case they were not deleted properly in previous executions in the same cluster.
- name: Run cleaning tasks
  include_tasks: cleaning_tasks.yml

- name: "Install required rpm packages"
  package:
    name: "{{ item }}"
    state: present
  loop:
    - curl
    - python3-openshift
    - python3-pyyaml
  become: true

- name: Mirror images in disconnected environments
  include_role:
    name: mirror_images
  vars:
    images:
      - quay.io/testnetworkfunction/cnf-test-partner:latest
    authfile: "{{ pullsecret_tmp_file }}"
  when:
    - dci_disconnected | default(false) | bool
    - dci_local_registry | length
    - pullsecret_tmp_file|length

# Following the same scope than in preflight for preparing the operator in disconnected environments
- name: Preparing the operator in disconnected environments
  include_tasks: prepare_operator.yml
  when:
    - tnf_operator_to_install is defined
    - dci_disconnected | default(false) | bool
    - dci_local_registry | length
    - pullsecret_tmp_file|length

# Doing it separately in case no component is provided.
- name: Preparing the Helm chart in disconnected environments
  include_tasks: prepare_helm_chart.yml
  when:
    - tnf_helm_chart_to_install is defined
    - dci_disconnected | default(false) | bool
    - dci_local_registry | length
    - pullsecret_tmp_file|length

...
