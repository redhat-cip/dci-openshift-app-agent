---
- name: Upload Ansible log to DCI Control Server
  environment:
    - DCI_CLIENT_ID: "{{ lookup('env', 'DCI_CLIENT_ID') }}"
    - DCI_API_SECRET: "{{ lookup('env', 'DCI_API_SECRET') }}"
    - DCI_CS_URL: "{{ lookup('env', 'DCI_CS_URL') }}"
  dci_file:
    path: "{{ item }}"
    name: "ansible.log"
    job_id: "{{ hostvars.jumphost.job_id }}"
  with_fileglob:
    - "{{ lookup('env', 'ANSIBLE_LOG_PATH') }}"
  delegate_to: localhost
- name: Upload logs to DCI Control Server
  environment:
    - DCI_CLIENT_ID: "{{ dci_client_id }}"
    - DCI_API_SECRET: "{{ dci_api_secret }}"
    - DCI_CS_URL: "{{ dci_cs_url }}"
  dci_file:
    path: "{{ item }}"
    name: "{{ item | basename }}"
    job_id: "{{ hostvars.localhost.job_id }}"
  with_fileglob:
    - "{{ job_logs.path }}/*"
