---
- name: "Check if ansible.log is present"
  stat:
    path: "{{ dci_config_dir }}/ansible.log"
  register: check_ansible_log

- name: "Copy ansible.log to job_logs temporary directory"
  copy:
  src: "{{ dci_config_dir }}/ansible.log"
  dest: "{{ job_logs.path }}/"
  when: check_ansible_log.stat.exists

- name: Upload logs to DCI Control Server
  environment:
    - DCI_CLIENT_ID: "{{ dci_client_id }}"
    - DCI_API_SECRET: "{{ dci_api_secret }}"
    - DCI_CS_URL: "{{ dci_cs_url }}"
  dci_file:
    path: "{{ item }}"
    name: "{{ item | basename }}"
    job_id: "{{ hostvars.localhost.job_id }}"
  with_fileglob:
    - "{{ job_logs.path }}/*"
